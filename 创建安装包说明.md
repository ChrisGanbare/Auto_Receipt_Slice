# 创建安装包说明

## 使用 Inno Setup 创建安装程序

### 步骤1：安装 Inno Setup

1. 访问 Inno Setup 官网：https://jrsoftware.org/isdl.php
2. 下载最新版本的 Inno Setup（推荐 6.x 版本）
3. 运行安装程序，按照向导完成安装

### 步骤2：准备文件

确保以下文件已准备好：

- ✅ `dist/农行电子回单智能拆分工具.exe`（已打包的主程序）
- ✅ `icon.ico`（程序图标，用于安装程序）
- ✅ `README.md`（可选，用户说明文档）
- ✅ `setup.iss`（Inno Setup 脚本文件）

### 步骤3：编译安装程序

1. 打开 **Inno Setup Compiler**
2. 点击 **File** -> **Open**，选择 `setup.iss` 文件
3. 检查脚本中的路径是否正确：
   - `Source: "dist\农行电子回单智能拆分工具.exe"` 路径是否正确
   - `SetupIconFile=icon.ico` 图标文件是否存在
4. 点击 **Build** -> **Compile**（或按 F9）
5. 等待编译完成
6. 在 `installer` 文件夹中找到生成的安装程序：
   - `农行电子回单智能拆分工具_安装程序.exe`

### 步骤4：测试安装程序

1. 在干净的Windows系统上测试（虚拟机或另一台电脑）
2. 运行安装程序，测试安装流程
3. 检查：
   - 桌面快捷方式是否正确创建
   - 开始菜单项是否正确
   - 程序是否可以正常启动
   - 卸载程序是否正常工作

## 自定义安装脚本

### 修改安装路径

在 `setup.iss` 中修改：

```iss
DefaultDirName={autopf}\{#MyAppName}  ; 默认安装到 Program Files
; 或
DefaultDirName={userpf}\{#MyAppName}  ; 安装到用户目录
```

### 添加许可协议

1. 创建 `license.txt` 文件
2. 在 `setup.iss` 中添加：

```iss
LicenseFile=license.txt
```

### 添加安装前/后信息

1. 创建 `info_before.txt` 和 `info_after.txt`
2. 在 `setup.iss` 中添加：

```iss
InfoBeforeFile=info_before.txt
InfoAfterFile=info_after.txt
```

### 添加额外文件

在 `[Files]` 部分添加：

```iss
Source: "用户使用手册.pdf"; DestDir: "{app}"; Flags: ignoreversion
Source: "示例回单.pdf"; DestDir: "{app}\examples"; Flags: ignoreversion
```

## 其他安装包工具

### NSIS (Nullsoft Scriptable Install System)

- 官网：https://nsis.sourceforge.io/
- 免费开源
- 功能强大，但脚本语法较复杂

### Advanced Installer

- 官网：https://www.advancedinstaller.com/
- 有免费版和付费版
- 图形界面，易于使用

### WiX Toolset

- 官网：https://wixtoolset.org/
- 微软官方工具
- 适合复杂的企业级应用

## 完整打包流程

```bash
# 1. 打包Python程序为exe
python build_exe.py

# 2. 检查生成的文件
# 确保 dist/农行电子回单智能拆分工具.exe 存在

# 3. 使用 Inno Setup 编译安装程序
# 打开 Inno Setup Compiler，打开 setup.iss，点击编译

# 4. 测试安装程序
# 在干净系统上测试安装和运行

# 5. 交付给用户
# 提供安装程序和用户手册
```

## 常见问题

### Q: 安装程序很大？
A: 这是正常的，包含了所有依赖库。可以考虑：
- 使用 `--onedir` 模式（文件夹形式）
- 压缩安装程序

### Q: 杀毒软件报毒？
A: 这是误报，可以：
- 添加数字签名（需要证书）
- 提交给杀毒软件厂商白名单
- 告知用户这是误报

### Q: 安装后无法运行？
A: 检查：
- 是否缺少运行库（Visual C++ Redistributable）
- 是否有权限问题
- 查看错误日志

## 优化建议

1. **数字签名**：为安装程序添加数字签名，提高信任度
2. **自动更新**：考虑添加自动更新功能
3. **安装统计**：添加安装统计（可选）
4. **多语言支持**：如果需要支持多语言，可以添加语言包

