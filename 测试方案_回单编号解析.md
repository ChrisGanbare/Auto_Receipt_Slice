# 回单编号解析功能测试方案

## 测试目标
验证回单编号提取功能能够正确识别和提取回单编号，避免误取账号等其他数字字段。

## 测试环境准备

### 1. 测试文件要求
- 使用真实的农行电子回单PDF文件
- 确保PDF文件包含以下字段：
  - 回单编号（通常为10-25位纯数字，如：`33019418708034925617`）
  - 付款方账号（如：`3803024019200193742`）
  - 收款方账号（如：`19921001040001707`）
  - 其他数字字段（金额、日期等）

### 2. 测试前检查清单
- [ ] 确认PDF文件可以正常打开
- [ ] 确认回单编号在PDF中清晰可见
- [ ] 记录回单编号的实际值（用于对比）
- [ ] 记录付款方和收款方账号（用于验证不会误取）

## 测试步骤

### 步骤1：启动程序
1. 运行 `main.py` 启动程序
2. 确认程序界面正常显示

### 步骤2：加载测试文件
1. 点击"1. 选择PDF源文件"按钮
2. 选择准备好的测试PDF文件
3. 观察状态栏提示"正在分析文件，请稍候..."
4. 等待解析完成

### 步骤3：检查解析结果
1. 在左侧"解析预览"表格中查看解析结果
2. 重点关注以下列：
   - **序号**：确认回单数量正确
   - **回单编号**：这是主要测试点
   - **客户名称**：确认是否正确
   - **金额**：确认是否正确
   - **状态**：查看是否有"需核对"标记

### 步骤4：验证回单编号
对每条记录进行验证：

#### 4.1 视觉验证
1. 在左侧表格中选中一条记录
2. 在右侧"回单原文预览"中查看对应的回单区域
3. 在预览图像中手动查找"回单编号"字段
4. 对比表格中显示的回单编号与预览图像中的实际值

#### 4.2 数据验证
1. 记录表格中显示的回单编号值
2. 在预览图像中确认回单编号的实际值
3. 对比两者是否一致

#### 4.3 误取验证
1. 检查回单编号是否误取了付款方账号
2. 检查回单编号是否误取了收款方账号
3. 检查回单编号是否误取了其他数字字段（如金额、日期等）

### 步骤5：详细检查（可选）
1. 双击表格中的记录，打开编辑窗口
2. 查看回单编号字段的值
3. 与预览图像中的实际值对比

## 测试用例

### 测试用例1：标准回单编号（20位数字）
**测试数据：**
- 回单编号：`33019418708034925617`
- 付款方账号：`3803024019200193742`
- 收款方账号：`19921001040001707`

**预期结果：**
- ✅ 回单编号正确提取为：`33019418708034925617`
- ✅ 不会误取付款方账号
- ✅ 不会误取收款方账号
- ✅ 状态显示为"正常"（如果其他字段也正确）

**验证方法：**
1. 在预览图像中确认回单编号位置
2. 对比提取值与实际值
3. 确认提取值不等于付款方或收款方账号

### 测试用例2：回单编号在表格左上角
**测试场景：**
- 回单编号位于表格的左上角位置
- 可能与其他字段在同一行或下一行

**预期结果：**
- ✅ 能正确识别"回单编号"标签
- ✅ 能正确提取回单编号的值
- ✅ 不会因为位置特殊而提取失败

### 测试用例3：回单编号被分割（多词）
**测试场景：**
- PDF解析时，回单编号可能被分割成多个词
- 例如：`3301941870` 和 `8034925617` 被识别为两个词

**预期结果：**
- ✅ 能正确合并被分割的数字
- ✅ 最终提取完整的回单编号
- ✅ 不会因为分割而提取不完整

### 测试用例4：回单编号附近有其他数字字段
**测试场景：**
- 回单编号附近有账号、金额等其他数字字段
- 这些字段可能在同一行或相邻行

**预期结果：**
- ✅ 只提取回单编号，不提取其他数字
- ✅ 遇到"账号"、"账户"等关键词时停止搜索
- ✅ 不会误取其他数字字段

### 测试用例5：多个回单（一页多单）
**测试场景：**
- PDF中包含多个回单
- 每个回单都有独立的回单编号

**预期结果：**
- ✅ 每个回单都能正确提取回单编号
- ✅ 不同回单的编号不会混淆
- ✅ 序号与回单编号一一对应

## 验证检查点

### 必须通过的检查点
- [ ] **回单编号格式正确**：应该是10-25位纯数字
- [ ] **回单编号值正确**：与预览图像中的实际值完全一致
- [ ] **不误取账号**：提取的值不等于付款方或收款方账号
- [ ] **不误取其他字段**：提取的值不等于金额、日期等其他数字字段

### 可选检查点
- [ ] 回单编号长度在合理范围内（10-25位）
- [ ] 如果回单编号提取失败，状态应显示"需核对"
- [ ] 可以手动编辑回单编号（双击记录）

## 问题排查

### 如果回单编号显示为"未知编号"

**可能原因：**
1. 搜索范围太小，没有找到回单编号
2. 停止关键词过早触发
3. 回单编号格式不符合预期（不是纯数字或长度不对）
4. PDF解析时"回单编号"标签识别失败

**排查步骤：**
1. 在预览图像中确认"回单编号"标签是否存在
2. 确认回单编号的值是否为纯数字
3. 确认回单编号的长度是否在10-25位之间
4. 检查回单编号是否被其他字段遮挡

### 如果回单编号误取了账号

**可能原因：**
1. 搜索范围太大，搜索到了账号区域
2. 停止关键词没有正确触发
3. y坐标限制不够严格

**排查步骤：**
1. 在预览图像中确认回单编号和账号的相对位置
2. 检查提取的值是否等于某个账号
3. 确认"回单编号"标签是否被正确识别

### 如果回单编号提取不完整

**可能原因：**
1. 回单编号被分割成多个词，合并逻辑有问题
2. 搜索范围太小，没有收集到所有数字片段

**排查步骤：**
1. 在预览图像中确认完整的回单编号
2. 检查提取的值是否只是回单编号的一部分
3. 确认数字是否被正确合并

## 测试记录表

| 测试序号 | 回单编号（实际值） | 提取值 | 付款方账号 | 收款方账号 | 结果 | 备注 |
|---------|------------------|--------|-----------|-----------|------|------|
| 1       |                  |        |           |           |      |      |
| 2       |                  |        |           |           |      |      |
| 3       |                  |        |           |           |      |      |

**结果说明：**
- ✅ 通过：提取值与实际值一致，且不误取账号
- ❌ 失败：提取值错误或误取了账号
- ⚠️ 部分通过：提取值正确但格式有问题，或需要手动修正

## 测试完成标准

### 基本要求（必须全部通过）
- [ ] 至少测试3个不同的回单文件
- [ ] 所有回单编号都能正确提取
- [ ] 没有误取账号的情况
- [ ] 提取值与实际值完全一致

### 高级要求（可选）
- [ ] 测试包含多个回单的PDF文件
- [ ] 测试回单编号格式不同的情况
- [ ] 测试回单编号位置特殊的情况

## 测试报告模板

```
测试日期：___________
测试人员：___________
测试文件：___________

测试结果摘要：
- 测试文件数量：___ 个
- 成功提取：___ 个
- 提取失败：___ 个
- 误取账号：___ 个

详细结果：
[记录每个测试用例的详细结果]

问题记录：
[记录发现的问题和异常情况]

建议：
[记录改进建议]
```

## 快速测试脚本（可选）

如果需要快速验证，可以：

1. **准备测试数据**
   - 准备1-2个包含明确回单编号的PDF文件
   - 记录每个回单编号的实际值

2. **执行测试**
   - 加载PDF文件
   - 快速检查解析结果
   - 对比提取值与实际值

3. **验证关键点**
   - 回单编号是否正确
   - 是否误取了账号
   - 状态是否正确

## 注意事项

1. **使用真实文件**：确保使用真实的农行电子回单PDF，不要使用模拟数据
2. **仔细对比**：在预览图像中仔细对比提取值与实际值
3. **记录问题**：如果发现问题，详细记录问题现象和复现步骤
4. **多文件测试**：尽量测试多个不同的PDF文件，确保功能的稳定性
5. **边界情况**：如果有特殊格式的回单，也要进行测试

