# 农行电子回单智能拆分工具

## 📋 目录

1. [软件简介](#软件简介)
2. [主要功能](#主要功能)
3. [系统要求](#系统要求)
4. [安装说明](#安装说明)
5. [使用指南](#使用指南)
6. [开发与打包](#开发与打包)
7. [常见问题](#常见问题)
8. [交付清单](#交付清单)
9. [技术支持](#技术支持)

---

## 软件简介

**农行电子回单智能拆分工具**是一款专为财务人员设计的PDF回单处理工具，可以自动识别和拆分中国农业银行的电子回单PDF文件，将多个回单拆分为独立的PDF文件，并自动提取客户名称、回单编号、金额等信息。

---

## 主要功能

- ✅ 自动识别农行电子回单格式
- ✅ 智能提取回单编号、客户名称、金额等信息
- ✅ 支持批量拆分多个回单
- ✅ 可预览和编辑回单信息
- ✅ 自动生成处理日志
- ✅ 支持本方公司户名自动匹配

---

## 系统要求

- **操作系统**：Windows 7 或更高版本（推荐 Windows 10/11）
- **内存**：至少 2GB RAM（推荐 4GB 或以上）
- **硬盘空间**：至少 100MB 可用空间
- **其他**：无需安装Python或其他开发环境

---

## 安装说明

### 方式一：使用安装包（推荐）

1. 双击运行 `农行电子回单智能拆分工具_安装程序.exe`
2. 如果系统提示"Windows已保护你的电脑"，请点击"更多信息"，然后选择"仍要运行"
3. 按照安装向导提示，选择安装路径（默认即可）
4. 点击"安装"按钮，等待安装完成
5. 安装完成后，点击"完成"按钮
6. 在桌面或开始菜单中找到"农行电子回单智能拆分工具"图标
7. 双击图标即可启动程序

### 方式二：使用绿色版（免安装）

1. 解压 `农行电子回单智能拆分工具_绿色版.zip` 到任意文件夹
   （建议解压到：`D:\Tools\农行回单拆分工具`）
2. 进入解压后的文件夹
3. 双击 `农行电子回单智能拆分工具.exe` 即可运行
4. **注意**：首次运行可能需要几秒钟加载时间，请耐心等待

---

## 使用指南

### 第一步：选择PDF源文件

1. 点击 **"1. 选择PDF源文件"** 按钮
2. 在弹出的文件选择对话框中，选择要处理的农行电子回单PDF文件
3. 选择后，程序会自动开始分析文件
4. 等待分析完成（状态栏会显示进度）

### 第二步：核对和编辑回单信息（可选）

#### 2.1 查看解析结果
- 在左侧 **"解析预览"** 表格中查看所有识别到的回单
- 表格显示：序号、客户名称、回单编号、金额、状态
- 点击任意一行，右侧会显示该回单的原文预览

#### 2.2 选择本方公司户名（可选）
- 如果PDF中包含您公司的付款记录，可以选择 **"电子回单本方公司户名"**
- 选择后点击 **"确认更新"**，系统会自动将对应记录的客户名称更新为收款方户名
- **如果不选择**，系统默认使用付款方户名作为客户名称

#### 2.3 编辑回单信息（如需要）
- **双击**表格中的任意一行，可以打开编辑窗口
- 可以修改：客户名称、回单编号、金额
- 修改后点击 **"保存"** 确认

#### 2.4 预览回单原文
- **单击**表格中的任意一行，右侧会显示该回单的图片预览
- 下方会显示可复制的文本内容
- 可以直接选中文本进行复制

### 第三步：开始拆分导出

1. 核对完所有回单信息后，点击 **"2. 开始拆分导出"** 按钮
2. 选择保存位置（建议选择专门的文件夹）
3. 等待处理完成（进度条会显示进度）
4. 处理完成后，会弹出提示窗口，并自动打开保存文件夹

### 导出结果说明

- **拆分后的PDF文件**：每个回单会生成一个独立的PDF文件
- **文件命名规则**：`客户名称_回单编号_金额.pdf`
- **日志文件**：自动生成 `log_YYYYMMDD_HHMMSS.csv`，记录所有处理结果

---

## 开发与打包

### 环境要求

- Python 3.7 或更高版本
- 依赖包（见 `requirements.txt`）

### 安装依赖

```bash
pip install -r requirements.txt
```

### 依赖列表

```
PyMuPDF>=1.23.0
pdfplumber>=0.10.0
```

### 打包说明

#### 方法一：使用打包脚本（推荐）

1. 确保已安装 PyInstaller：
```bash
pip install pyinstaller
```

2. 运行打包脚本：
```bash
python build_exe.py
```

3. 打包完成后，在 `dist` 文件夹中找到 `农行电子回单智能拆分工具.exe`

#### 方法二：手动打包

在项目根目录执行：

```bash
pyinstaller --name=农行电子回单智能拆分工具 ^
    --onefile ^
    --windowed ^
    --icon=icon.ico ^
    --add-data="README.md;." ^
    --hidden-import=tkinter ^
    --hidden-import=tkinter.ttk ^
    --hidden-import=fitz ^
    --hidden-import=pdfplumber ^
    --clean ^
    --noconfirm ^
    main.py
```

#### 打包参数说明

- `--onefile`: 打包成单个exe文件
- `--windowed`: 不显示控制台窗口（GUI程序）
- `--icon=icon.ico`: 指定程序图标（如果有）
- `--clean`: 清理临时文件
- `--noconfirm`: 覆盖输出目录时不提示

#### 测试打包结果

1. 在干净的Windows系统上测试（虚拟机或另一台电脑）
2. 确保没有Python环境的电脑也能运行
3. 测试所有功能是否正常

#### 打包常见问题

**Q: 打包后文件很大？**  
A: 这是正常的，PyInstaller会打包所有依赖库。可以使用 `--exclude-module` 排除不需要的模块。

**Q: 杀毒软件报毒？**  
A: 这是误报，因为PyInstaller打包的程序可能被误判。可以：
- 添加数字签名
- 提交给杀毒软件厂商白名单
- 告知用户这是误报

**Q: 程序启动慢？**  
A: 单文件打包的程序首次启动需要解压，这是正常的。可以考虑使用 `--onedir` 模式。

#### 优化建议

1. **添加版本信息**：使用 `--version-file=version.txt` 添加版本信息
2. **减小文件大小**：排除不需要的模块
3. **创建安装包**：使用 Inno Setup 创建专业的安装程序

### build 目录说明

打包过程中会在 `build` 目录生成临时文件，主要包括：

- **`.spec` 文件**：PyInstaller 配置文件，包含所有打包参数
- **`Analysis-00.toc`**：记录所有依赖模块
- **`base_library.zip`**：Python 标准库压缩包
- **`PYZ-00.pyz`**：Python 字节码压缩包
- **`warn-*.txt`**：警告信息文件，用于排查问题
- **`xref-*.html`**：依赖关系可视化报告

**重要提示：**
- build 目录是临时工作目录，打包完成后可以安全删除
- 最终的可执行文件在 `dist` 目录中
- 大部分警告是正常的，不影响程序运行

---

## 常见问题

### Q1: 程序无法启动或报错？
**A:** 
- 确保您的电脑是Windows系统
- 尝试右键点击程序，选择"以管理员身份运行"
- 检查是否有杀毒软件拦截，如有请添加信任

### Q2: 识别不到回单或识别错误？
**A:**
- 确保PDF文件是农行电子回单格式
- 检查PDF文件是否完整、未损坏
- 如果识别错误，可以双击表格中的记录手动修改

### Q3: 客户名称显示不正确？
**A:**
- 如果付款方是您公司，请选择"电子回单本方公司户名"并确认更新
- 也可以双击记录手动修改客户名称

### Q4: 导出失败或文件打不开？
**A:**
- 确保保存位置有足够的磁盘空间
- 检查保存路径是否包含特殊字符
- 确保有写入权限

### Q5: 处理速度慢？
**A:**
- 大文件或回单数量多时，处理需要一定时间，请耐心等待
- 可以查看进度条了解处理进度

### Q6: 可以批量处理多个PDF文件吗？
**A:**
- 当前版本一次只能处理一个PDF文件
- 如需处理多个文件，请逐个打开处理

---

## 交付清单

### 必需文件

- [x] **主程序文件**
  - `农行电子回单智能拆分工具.exe` (打包后的可执行文件)
  
- [x] **安装程序**（可选，如果使用安装包方式）
  - `农行电子回单智能拆分工具_安装程序.exe`
  - 或使用 Inno Setup / NSIS 等工具制作的安装包

- [x] **用户文档**
  - `README.md` 或 `用户使用手册.pdf`
  - `安装说明.txt`

### 可选文件

- [ ] **图标文件**（如果已设计）
  - `icon.ico` - 程序图标
  - `logo.png` - 公司/产品Logo

- [ ] **示例文件**
  - `示例回单.pdf` - 用于用户测试的示例文件

- [ ] **更新日志**
  - `更新日志.txt` - 版本更新记录

### 交付方式建议

#### 方式一：完整安装包（推荐给企业用户）

```
交付文件夹/
├── 农行电子回单智能拆分工具_安装程序.exe
├── 用户使用手册.pdf
├── 安装说明.txt
└── 示例回单.pdf（可选）
```

#### 方式二：绿色版（推荐给个人用户）

```
交付文件夹/
├── 农行电子回单智能拆分工具_绿色版/
│   ├── 农行电子回单智能拆分工具.exe
│   └── 用户使用手册.pdf
├── 安装说明.txt
└── 示例回单.pdf（可选）
```

#### 方式三：压缩包（网络传输）

```
农行电子回单智能拆分工具_V1.0.0.zip
├── 农行电子回单智能拆分工具.exe
├── 用户使用手册.pdf
├── 安装说明.txt
└── README.txt（简要说明）
```

### 交付前检查清单

#### 功能测试
- [ ] 程序可以正常启动
- [ ] 可以正常选择PDF文件
- [ ] 可以正常解析回单
- [ ] 可以正常预览回单
- [ ] 可以正常编辑回单信息
- [ ] 可以正常导出拆分文件
- [ ] 日志文件正常生成

#### 兼容性测试
- [ ] Windows 7 测试通过
- [ ] Windows 10 测试通过
- [ ] Windows 11 测试通过
- [ ] 64位系统测试

#### 用户体验测试
- [ ] 界面显示正常
- [ ] 文字清晰可读
- [ ] 按钮功能明确
- [ ] 错误提示友好
- [ ] 操作流程顺畅

---

## 注意事项

### ⚠️ 重要提示

1. **文件备份**：处理前建议备份原始PDF文件
2. **文件格式**：仅支持中国农业银行的电子回单PDF格式
3. **数据核对**：导出后请核对拆分结果，确保信息正确
4. **文件命名**：如果文件名重复，系统会自动添加序号（如：`客户名称_编号_金额_1.pdf`）

### 📝 使用建议

1. **首次使用**：建议先用一个小的PDF文件测试，熟悉操作流程
2. **定期更新**：如有新版本，建议及时更新以获得更好的体验
3. **问题反馈**：如遇到问题，请记录错误信息并联系技术支持

### 🔒 数据安全

- 本工具为本地处理，所有数据不会上传到网络
- 处理后的文件保存在您指定的本地文件夹
- 建议定期清理临时文件

---

## 技术支持

如遇到问题或需要帮助，请联系技术支持团队。

**版本信息**：V1.0.0  
**更新日期**：2024年

---

*祝您使用愉快！*
